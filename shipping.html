<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</title>

<!-- ‡πÇ‡∏´‡∏•‡∏î Leaflet (‡∏ü‡∏£‡∏µ) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body{
  font-family:sans-serif;
  background:#fff5f8;
  padding:20px;
}
.box{
  max-width:450px;
  margin:auto;
  background:white;
  padding:20px;
  border-radius:15px;
}
input, textarea{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:10px;
  border:1px solid #ccc;
}
button{
  width:100%;
  padding:12px;
  background:#ff69b4;
  color:white;
  border:none;
  border-radius:20px;
  font-size:16px;
  cursor:pointer;
}
#map{
  height:300px;
  margin-top:10px;
  border-radius:10px;
}
</style>
</head>

<body>

<div class="box">
<h2>üì¶ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h2>

<input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
<textarea id="address" placeholder="‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà"></textarea>
<input id="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">

<div id="map"></div>

<button onclick="goPay()">‡πÑ‡∏õ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
</div>

<script>
// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
var map = L.map('map').setView([13.736717, 100.523186], 6);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

var marker;

map.on('click', function(e){

  if(marker){
    map.removeLayer(marker);
  }

  marker = L.marker(e.latlng).addTo(map);

  // ‡∏î‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å OpenStreetMap ‡∏ü‡∏£‡∏µ
  fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e.latlng.lat}&lon=${e.latlng.lng}&accept-language=th`)
  .then(response => response.json())
  .then(data => {

    let addr = data.address;

    let house = addr.house_number || "";
    let road = addr.road || "";
    let subdistrict = addr.suburb || addr.village || "";
    let district = addr.city_district || addr.county || "";
    let province = addr.state || "";
    let postcode = addr.postcode || "";

    let fullAddress = 
      (house ? "‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà " + house + " " : "") +
      (road ? road + " " : "") +
      (subdistrict ? "‡∏ï‡∏≥‡∏ö‡∏•" + subdistrict + " " : "") +
      (district ? "‡∏≠‡∏≥‡πÄ‡∏†‡∏≠" + district + " " : "") +
      (province ? "‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î" + province + " " : "") +
      (postcode ? postcode : "");

    document.getElementById("address").value = fullAddress;
  })
  .catch(error => {
    document.getElementById("address").value =
      "‡∏û‡∏¥‡∏Å‡∏±‡∏î: " + e.latlng.lat.toFixed(6) + ", " + e.latlng.lng.toFixed(6);
  });

});
function goPay(){

  let name = document.getElementById("name").value.trim();
  let address = document.getElementById("address").value.trim();
  let phone = document.getElementById("phone").value.trim();

  if(!name || !address || !phone){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô");
    return;
  }

  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ß‡πâ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
  localStorage.setItem("customer_name", name);
  localStorage.setItem("customer_address", address);
  localStorage.setItem("customer_phone", phone);

  // ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
  window.location.href = "payment.html";
}

</script>


</body>
</html>
