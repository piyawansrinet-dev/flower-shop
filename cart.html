<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</title>

<style>
body{
  font-family:sans-serif;
  background:#fff5f8;
  padding:20px;
}
.box{
  max-width:500px;
  margin:auto;
  background:white;
  padding:20px;
  border-radius:15px;
}
.item{
  border-bottom:1px solid #eee;
  padding:10px 0;
}
.total{
  font-weight:bold;
  text-align:right;
  margin-top:15px;
}
button{
  width:100%;
  padding:12px;
  background:#06C755;
  color:white;
  border:none;
  border-radius:20px;
  margin-top:15px;
  font-size:16px;
}
</style>
</head>
<body>

<div class="box">
<h2>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>

<div id="cartItems"></div>

<h3 id="totalPrice"></h3>

<button onclick="orderLine()" style="
  background:#06C755;
  color:white;
  padding:15px 30px;
  border:none;
  border-radius:30px;
  font-size:18px;
  cursor:pointer;
">
  üí¨ ‡∏™‡∏±‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô LINE
</button>
  </a>
</div>

<script>

let cart = JSON.parse(localStorage.getItem("cart")) || [];
let total = 0;

const cartDiv = document.getElementById("cartItems");

if(cart.length === 0){
  cartDiv.innerHTML = "<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>";
}else{

  cart.forEach((item, index) => {

  total += item.price * item.qty;

  cartDiv.innerHTML += `
    <div class="item">
      <b>${item.name}</b><br>
      ‡∏£‡∏≤‡∏Ñ‡∏≤ ${item.price} ‡∏ö‡∏≤‡∏ó √ó ${item.qty}
      <br>
      <button onclick="removeItem(${index})" 
        style="background:red;color:white;border:none;padding:5px 10px;border-radius:10px;margin-top:5px;">
        ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
      </button>
    </div>
  `;
});
function removeItem(index){
  cart.splice(index,1);
  localStorage.setItem("cart", JSON.stringify(cart));
  location.reload();
}
document.getElementById("totalPrice").innerText = total;
}

function sendCartToLine(){

  if(cart.length === 0){
    alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤");
    return;
  }

  let message = "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞ üå∏\n‡∏Ç‡∏≠‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤\n\n";

  cart.forEach(item=>{
    message += `${item.name} √ó ${item.qty} = ${item.price * item.qty} ‡∏ö‡∏≤‡∏ó\n`;
  });

  message += `\n‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${total} ‡∏ö‡∏≤‡∏ó`;

  // üî• ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤ Google Sheet
  fetch("https://script.google.com/macros/s/AKfycbwkqasWNWYPJJjHb_QOoRhXOZF8pztQp5igYPwoYX_N7rvaoAgKaWGxNsw1peShWYgg/exec", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      name: "‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ LINE",
      phone: "-",
      address: "-",
      items: cart.map(i => i.name + " x" + i.qty).join(", "),
      total: total
    })
  });

  window.open(
  "https://line.me/R/ti/p/@935abhab?text=" + encodeURIComponent(message),
  "_blank"
);

  // ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
  localStorage.removeItem("cart");
}
const btn = document.getElementById("lineOrderBtn");

btn.addEventListener("click", function(){

  const items = localStorage.getItem("cart") || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤";
  const total = localStorage.getItem("total") || "0";

  const message = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞\n‡∏Ç‡∏≠‡∏™‡∏±‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤\n\n‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:\n${items}\n\n‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${total} ‡∏ö‡∏≤‡∏ó`;

  const encoded = encodeURIComponent(message);

  btn.href = "https://line.me/R/ti/p/@376ignkd/?text=" + encoded;
});
</script>
<script>
function renderCart(){
  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  const container = document.getElementById("cartItems");
  const totalEl = document.getElementById("totalPrice");

  container.innerHTML = "";

  let total = 0;

  cart.forEach((item, index)=>{
    total += item.price * item.qty;

    container.innerHTML += `
      <div style="margin-bottom:15px; padding:10px; background:white; border-radius:10px;">
        <b>${item.name}</b><br>
        ‡∏£‡∏≤‡∏Ñ‡∏≤ ${item.price} ‡∏ö‡∏≤‡∏ó x ${item.qty}
      </div>
    `;
  });

  totalEl.innerHTML = "‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: " + total + " ‡∏ö‡∏≤‡∏ó";
}

function orderLine(){
  let cart = JSON.parse(localStorage.getItem("cart")) || [];

  if(cart.length === 0){
    alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤");
    return;
  }

  let message = "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞ ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:\n\n";
  let total = 0;

  cart.forEach(item=>{
    message += `- ${item.name} (${item.price} ‡∏ö‡∏≤‡∏ó x ${item.qty})\n`;
    total += item.price * item.qty;
  });

  message += `\n‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${total} ‡∏ö‡∏≤‡∏ó`;

  let encodedMessage = encodeURIComponent(message);

  window.open(
    "https://line.me/R/ti/p/@376ignkd?text=" + encodedMessage,
    "_blank"
  );

  // ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏™‡∏±‡πà‡∏á
  localStorage.removeItem("cart");
}

renderCart();
</script>
</body>
</html>