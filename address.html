<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body{font-family:sans-serif;background:#fff5f8;padding:20px;}
.box{max-width:500px;margin:auto;background:white;padding:20px;border-radius:15px;}
input{width:100%;padding:10px;margin:6px 0;border-radius:10px;border:1px solid #ccc;}
button{width:100%;padding:12px;background:#ff69b4;color:white;border:none;border-radius:20px;font-size:16px;cursor:pointer;margin-top:10px;}
#map{height:300px;margin-top:10px;border-radius:10px;}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
</style>
</head>

<body>
<div class="box">
<h2>üì¶ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h2>

<input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
<input id="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">

<div class="grid">
<input id="house" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà">
<input id="road" placeholder="‡∏ñ‡∏ô‡∏ô">
<input id="subdistrict" placeholder="‡∏ï‡∏≥‡∏ö‡∏•">
<input id="district" placeholder="‡∏≠‡∏≥‡πÄ‡∏†‡∏≠">
<input id="province" placeholder="‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î">
<input id="postcode" placeholder="‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå">
</div>

<div id="map"></div>

<button onclick="goPay()">‡πÑ‡∏õ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
</div>

<script>
var map = L.map('map').setView([13.736717,100.523186],6);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
 attribution:'&copy; OpenStreetMap'
}).addTo(map);

var marker;

map.on('click',function(e){

 if(marker){map.removeLayer(marker);}
 marker = L.marker(e.latlng).addTo(map);

 fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e.latlng.lat}&lon=${e.latlng.lng}&accept-language=th`)
 .then(res=>res.json())
 .then(data=>{

   if(!data.address){return;}

   if(data.address.country !== "‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢"){
     alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");
     map.removeLayer(marker);
     return;
   }

   let a=data.address;

   document.getElementById("house").value=a.house_number||"";
   document.getElementById("road").value=a.road||"";
   document.getElementById("subdistrict").value=a.suburb||a.village||"";
   document.getElementById("district").value=a.county||"";
   document.getElementById("province").value=a.state||"";
   document.getElementById("postcode").value=a.postcode||"";

 });

});

function goPay(){

 let name = document.getElementById("name").value.trim();
 let phone = document.getElementById("phone").value.trim();
 let house = document.getElementById("house");
 let road = document.getElementById("road");
 let subdistrict = document.getElementById("subdistrict");
 let district = document.getElementById("district");
 let province = document.getElementById("province");
 let postcode = document.getElementById("postcode");

 if(!name || !phone || !house.value){
   alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
   return;
 }

 // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á localStorage
 localStorage.setItem("name", name);
 localStorage.setItem("phone", phone);
 localStorage.setItem("house", house.value);
 localStorage.setItem("road", road.value);
 localStorage.setItem("subdistrict", subdistrict.value);
 localStorage.setItem("district", district.value);
 localStorage.setItem("province", province.value);
 localStorage.setItem("postcode", postcode.value);

 window.location.href="payment.html";
}

</script>

</body>
</html>
